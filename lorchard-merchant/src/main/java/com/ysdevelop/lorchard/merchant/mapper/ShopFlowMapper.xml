<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ysdevelop.lorchard.merchant.mapper.ShopFlowDao">

	<insert id="addDailyShopFlow">
	INSERT INTO `t_lorchard_mall_shop_flow_stat_daily_site`(
	`pageView` ,`visitorNumber` ,`goodsView` ,`goodsAceessNumber` ,`date` ,
	`createTime`)
	VALUES
	(IFNULL(( SELECT count(id) FROM
	`t_lorchard_mall_shop_system_log` WHERE
	DATEDIFF(`createTime` , NOW()) =-
	1) ,0),
	IFNULL(( SELECT
	count(DISTINCT(memberId)) FROM
	`t_lorchard_mall_shop_system_log`
	WHERE
	DATEDIFF(`createTime` , NOW()) =-1) ,0),
	IFNULL((SELECT count(id)
	FROM `t_lorchard_mall_shop_system_log`
	WHERE
	type = 1 AND(
	DATEDIFF(`createTime` , NOW()) =- 1)) ,0) ,
	IFNULL((SELECT count(DISTINCT(`goodsId`)) FROM
	`t_lorchard_mall_shop_system_log`
	WHERE
	type = 1 AND(
	DATEDIFF(`createTime` , NOW()) =- 1)
	) ,0) ,
	date_sub(curdate(),interval 1 day),
	NOW()
	)
	</insert>
	
	<select id="recentSevenDayStat" resultType="com.ysdevelop.lorchard.merchant.entity.ShopFlow">
	SELECT
	a.click_date AS `date`,
	ifnull(b.pageView, 0) AS pageView,
	IFNULL(b.`visitorNumber`, 0) AS `visitorNumber`,
	IFNULL(b.`goodsView`, 0) AS `goodsView`,
	IFNULL(b.`goodsAceessNumber`, 0) AS `goodsAceessNumber`
    FROM
	(
		SELECT
			date_sub(curdate(), INTERVAL 1 DAY) AS click_date
		UNION ALL
		    SELECT
			date_sub(curdate(), INTERVAL 2 DAY) AS click_date
		UNION ALL
			SELECT
		    date_sub(curdate(), INTERVAL 3 DAY) AS click_date
		UNION ALL
			SELECT
			date_sub(curdate(), INTERVAL 4 DAY) AS click_date
		UNION ALL
			SELECT
			date_sub(curdate(), INTERVAL 5 DAY) AS click_date
			UNION ALL
		SELECT
			date_sub(curdate(), INTERVAL 6 DAY) AS click_date
			UNION ALL
			SELECT
			date_sub(curdate(), INTERVAL 7 DAY) AS click_date
	    ) a
      LEFT JOIN (
	   SELECT
		  `pageView`,
		  `visitorNumber`,
		  `goodsView`,
		  `goodsAceessNumber`,
		  `date`,
		  `createTime`
   	  FROM
		`t_lorchard_mall_shop_flow_stat_daily_site`
      ) b ON a.`click_date` = b.`date`
	</select>


</mapper>